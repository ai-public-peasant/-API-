name: law-procurement-discovery
description: |
  사용자가 "법령 분석/조회/어떤 규정을 찾아볼까?"라고 물으면
  대상 법령을 확인해 법제처 최신 법령 XML을 다운로드하고,
  연관법령·연관규정을 함께 수집하는 스킬.

---

# 법령 탐색·연관규정 수집 스킬 (법제처)

이 스킬은 사용자가 법령/규정 분석 의도를 보였을 때 **즉시 활성화**한다.

## 트리거 문구 예시
- "어떤 법령을 찾아보겠냐"
- "법령 분석해볼까?"
- "이 법령 관련 규정/연관법령 확인해줘"
- "OO 법령 최신본 받아줘"

## 기본 동작
1. 사용자에게 바로 확인 질문을 한다.
   - "어떤 법령/규정을 찾아보겠냐?"
   - "어떤 법령을 기준으로 연관법령까지 같이 받을까?"
   - "기관/업무 맥락(부서명, 분석 목적)을 알려주면 정확도를 높일 수 있다."
2. 사용자 답변을 받으면 다음을 알린다.
   - "법제처 최신법령을 다운로드하겠다."
3. 법령별로 법제처 API로 최신 XML 다운로드를 수행한다.
4. 각 법령 XML에서 연관 조문/인용 규정 후보를 추출해 연관규정도 함께 수집한다.
5. 수집 결과를 체크리스트와 경로로 정리한다.

## 대상 스킬/흐름에서 분리된 이유
- `dept-law-collection`은 기존 분석/통합 워크플로 중심
- 본 스킬은 **"요청 즉시 최신법령 획득 + 연관규정 확보"** 단계만 담당

## 사용 대상 파일
- `03_분석보고서/[부서명]/laws/`  
- `03_분석보고서/[부서명]/law_collection_report.md`

## 전제 조건
- 법제처 API 접근 자격(OC ID) 보유
- 법령명 또는 법령 약호(예: 지방재정법) 입력
- 요청 법령 수(권장 최대 10개)

## API 사용 절차 (최신법령 기준)
- 검색:
  - `http://www.law.go.kr/DRF/lawSearch.do?OC=[OC_ID]&target=law&type=XML&query=[법령명]`
- 본문 조회:
  - `http://www.law.go.kr/DRF/lawService.do?OC=[OC_ID]&target=law&MST=[법령일련번호]&type=XML`

## 세부 워크플로우

### 1단계: 대상 수집
- 사용자에게 다음을 순차 확인:
  - 대상 법령명(여러 개 허용)
  - 최신본/유지본 기준일(기준일)
  - 연관규정 탐색 깊이(1단계만 or 2단계까지)
  - 결과 저장 경로

### 2단계: 법령 정규화
- 동일 법령 중복 제거
- 최신 개정일 기준 정렬
- 유사명(예: 지역 조례/시행세칙) 분리 확인 후 사용자 확인 필요 시 분기

### 3단계: 법제처 다운로드
- 각 대상 법령에 대해 검색→MST 획득→XML 다운로드
- 실패 사유(검색 없음/오타/비공개)는 즉시 피드백

### 4단계: 연관규정 추출
- 다운로드된 XML에서 아래 패턴 기반 후보 추출:
  - 다른 법률 조문 인용 표시
  - 「제X조의2」「~에 따라」 패턴
  - 시행/개정/준용 참조 구문
- 후보는 법제처 API로 1차 검증 후 중복 제거 후 우선순위 정렬

### 5단계: 연관규정 다운로드
- 우선순위 상위 N개(권장 8~15개)부터 순차 다운로드
- 대상 범위 초과 시 사용자 승인 후 진행
- 최종적으로 "요청 대상 + 연관규정" 묶음으로 저장

### 6단계: 산출물 정리
- `law_collection_report.md` 작성 항목:
  - 요청 법령 목록(성공/실패)
  - 연관규정 후보/확정 목록
  - XML 저장 위치
  - 실패항목 및 수동대체 제안(웹링크)

## 실패/예외 처리
- 검색 불가: 오타/동음이의어일 경우 대체 키워드 제안
- API 실패: 429/차단 회피 위해 1초 간격 유지
- 조문 인용만 있는 종합규정: "관련성 높음" 태그 후 수동 검토 제안

## 사용자 응답 템플릿
- "요청한 법령은 [X개]개이며, 법제처 최신본 다운로드를 시작한다."
- "주요 연관규정 [Y개]개를 찾아 함께 수집할 예정이다."
- "완료 시 `laws/`와 `law_collection_report.md`로 정리해 공유하겠다."
